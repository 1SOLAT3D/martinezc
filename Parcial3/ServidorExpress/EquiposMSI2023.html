<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="EquiposMSI2023.css">
    <title>Equipos MSI 2023</title>
</head>

<body>
    <form>
        <div class="container">
            Equipos MSI 2023
            <div class="form-group">
                <label for="idequipo">ID Equipo</label>
                <input id="idEquipo" type="text" class="form-control">
            </div>

            <div class="form-group">
                <label for="idRegion">Region</label>
                <input id="idRegion" type="text" class="form-control">
            </div>

            <div class="form-group">
                <label for="nombreEquipo">Nombre</label>
                <input id="nombreEquipo" type="text" class="form-control">
            </div>

            <div class="form-group">
                <label for="acronimo">Acronimo</label>
                <input id="acronimo" type="text" class="form-control">
            </div>

            <div class="form-group">
                <label for="paisEquipo">País</label>
                <input id="paisEquipo" type="text" class="form-control">
            </div>

            <div class="form-group">
                <label for="seed">Seed Regional</label>
                <input id="seed" type="text" class="form-control">
            </div>

            <button id="btnConsultaPorID" type="button" class="btn btn-primary">Consultar Equipo Por ID</button>
            <button onclick="obtenerDatos()" id="btnConsultar" type="button" class="btn btn-primary">Mostrar Datos</button>
            <button id="btnAgregar" type="button" class="btn btn-success">Agregar Equipo</button>
            <button id="btnBorrar" type="button" class="btn btn-danger">Borrar Equipo</button>
            <button id="btnModificar" type="button" class="btn btn-success">Modificar Equipo</button>
            <button id="btnLimpiar" type="button" class="btn btn-success">Limpiar</button>

            <div id="wrapper"></div>
            
            <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
        </div>

        <script>
                const obtenerDatos = () => {
                    fetch(`http://localhost:8082/msi2023`)
                        .then(response => response.json())
                        .then(data => {
                            new gridjs.Grid({
                                columns: ['Nombre del Equipo', 'Acrónimo', 'País del Equipo', 'Seed de Liga'],
                                server: {
                                    url: 'http://localhost:8082/msi2023',
                                    then: data => data.map(equipo =>
                                        [equipo.nombreEquipo, equipo.acronimo, equipo.paisEquipo, equipo.seed]
                                    )
                                }
                            }).render(document.getElementById("wrapper"));
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                };
                
                document.getElementById("btnConsultaPorID").addEventListener("click", function () {
                        let id = prompt("Teclee el ID del Usuario");
                        fetch('http://localhost:8082/msi2023?idEquipo=' + id)
                            .then(respuesta => respuesta.json())
                            .then(objetoEquipo => {
                                document.getElementById("idEquipo").value = objetoEquipo[id-1].idEquipo,
                                    document.getElementById("idRegion").value = objetoEquipo[id-1].idRegion,
                                    document.getElementById("nombreEquipo").value = objetoEquipo[id-1].nombreEquipo,
                                    document.getElementById("acronimo").value = objetoEquipo[id-1].acronimo,
                                    document.getElementById("paisEquipo").value = objetoEquipo[id-1].paisEquipo,
                                    document.getElementById("seed").value = objetoEquipo[id-1].seed;

                                    new gridjs.Grid({
                                    columns: ['Nombre del Equipo', 'Acrónimo', 'País del Equipo', 'Seed de Liga'],
                                    server: {
                                        url: 'http://localhost:8082/msi2023/' + id,
                                        then: data => data.map(equipo =>
                                            [equipo.nombreEquipo, equipo.acronimo, equipo.paisEquipo, equipo.seed]
                                        )
                                    }
                                }).render(document.getElementById("wrapper"));
                            });
                    });

            document.getElementById("btnBorrar").addEventListener("click", function () {
                let id = prompt("Teclee el ID del Equipo");
                fetch('http://localhost:8082/msi2023/' + id, {
                    method: "DELETE"
                })
                    .then(respuesta => respuesta.json())
                    .then(objetoRespuesta => {
                        if (objetoRespuesta.estado == 1) {
                            alert(objetoRespuesta.resultado);
                            document.getElementById("idEquipo").value = '';
                            document.getElementById("idRegion").value = '';
                            document.getElementById("nombreEquipo").value = '';
                            document.getElementById("acronimo").value = '';
                            document.getElementById("paisEquipo").value = '';
                            document.getElementById("seed").value = '';
                        }
                        else {
                            alert(objetoRespuesta.resultado);
                        }
                    });
            });

            document.getElementById("btnAgregar").addEventListener("click", function () {
                    let idEquipo = document.getElementById("idEquipo").value;
                    let idRegion = document.getElementById("idRegion").value;
                    let nombreEquipo = document.getElementById("nombreEquipo").value;
                    let acronimo = document.getElementById("acronimo").value;
                    let paisEquipo = document.getElementById("paisEquipo").value;
                    let seed = document.getElementById("seed").value;

                    if (idEquipo === '' || idRegion === '' || nombreEquipo === '' || acronimo === '' || paisEquipo === '' || seed === '') {
                        alert('Por favor complete todos los campos.');
                    } else {
                        fetch('http://localhost:8082/msi2023', {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify({
                                "idEquipo": idEquipo,
                                "idRegion": idRegion,
                                "nombreEquipo": nombreEquipo,
                                "acronimo": acronimo,
                                "paisEquipo": paisEquipo,
                                "seed": seed
                            })
                        })
                            .then(respuesta => respuesta.json())
                            .then(objetoRespuesta => {
                                if (objetoRespuesta.estado == 1) {
                                    alert(objetoRespuesta.resultado);
                                    document.getElementById("idEquipo").value = '';
                                    document.getElementById("idRegion").value = '';
                                    document.getElementById("nombreEquipo").value = '';
                                    document.getElementById("acronimo").value = '';
                                    document.getElementById("paisEquipo").value = '';
                                    document.getElementById("seed").value = '';
                                } else {
                                    alert(objetoRespuesta.resultado);
                                }
                            });
                    }
                });


            document.getElementById("btnModificar").addEventListener("click", function () {
                let idEquipo = document.getElementById("idEquipo").value;
                let idRegion = document.getElementById("idRegion").value;
                let nombreEquipo = document.getElementById("nombreEquipo").value;
                let acronimo = document.getElementById("acronimo").value;
                let paisEquipo = document.getElementById("paisEquipo").value;
                let seed = document.getElementById("seed").value;

                fetch(`http://localhost:8082/msi2023/${idEquipo}`, {
                    method: "PUT",
                    body: JSON.stringify({
                        "idEquipo": idEquipo,
                        "idRegion": idRegion,
                        "nombreEquipo": nombreEquipo,
                        "acronimo": acronimo,
                        "paisEquipo": paisEquipo,
                        "seed": seed
                    }),
                    headers: { "Content-Type": "application/json" }
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error("Error al intentar modificar el equipo");
                        }
                        console.log(response);
                        return response.json();
                    })
                    .then((data) => {
                        console.log(data);
                    })
                    .catch((error) => {
                        console.error(error);
                    });
            });

            document.getElementById("btnLimpiar").addEventListener("click", function () {
                const inputs = document.querySelectorAll('input');
                inputs.forEach(input => {
                    input.value = '';
                });
            });
        </script>
    </form>
</body>

</html>